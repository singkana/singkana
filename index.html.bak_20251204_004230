<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>SingKANA Î² â€“ è‹±èªæ­Œè©ã‹ãªå¤‰æ›ã‚¹ã‚¿ã‚¸ã‚ª</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color-scheme: light;
    }
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      background: radial-gradient(circle at top left, #f7f5ff, #fdfbff 40%, #ffffff 80%);
      color: #222;
    }
    .page {
      max-width: 960px;
      margin: 0 auto;
      padding: 24px 16px 40px;
    }
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 24px;
    }
    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .logo-mark {
      width: 36px;
      height: 36px;
      border-radius: 18px;
      background: linear-gradient(135deg, #8f7bf5, #f58fdc);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      color: #fff;
      font-weight: 700;
    }
    .logo-text-main {
      font-weight: 700;
      letter-spacing: 0.04em;
      font-size: 18px;
    }
    .logo-text-sub {
      font-size: 11px;
      color: #666;
    }
    .badge-beta {
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 11px;
      background: #fff;
      border: 1px solid #e0ddff;
      color: #7b6cf0;
    }

    .hero {
      background: rgba(255, 255, 255, 0.9);
      border-radius: 20px;
      padding: 20px 18px;
      border: 1px solid #eee7ff;
      box-shadow: 0 18px 45px rgba(143, 123, 245, 0.12);
      margin-bottom: 20px;
    }
    .hero-title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 8px;
    }
    .hero-sub {
      font-size: 13px;
      color: #555;
      margin-bottom: 16px;
    }
    .hero-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 11px;
      background: #f4f0ff;
      color: #6b5ad8;
      margin-bottom: 8px;
    }

    .layout {
      display: grid;
      grid-template-columns: 5fr 4fr;
      gap: 14px;
      margin-bottom: 18px;
    }

    @media (max-width: 700px) {
      .layout {
        grid-template-columns: 1fr;
      }
    }

    .card {
      background: #ffffff;
      border-radius: 16px;
      padding: 14px 14px 16px;
      border: 1px solid #eee7ff;
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.02);
    }
    .card-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 6px;
    }
    .card-sub {
      font-size: 11px;
      color: #777;
      margin-bottom: 10px;
    }

    textarea {
      width: 100%;
      border-radius: 10px;
      border: 1px solid #ddd5ff;
      padding: 10px 11px;
      font-family: inherit;
      font-size: 13px;
      resize: vertical;
      min-height: 140px;
      outline: none;
      background: #faf8ff;
    }
    textarea:focus {
      border-color: #8f7bf5;
      box-shadow: 0 0 0 1px rgba(143, 123, 245, 0.2);
      background: #ffffff;
    }

    .input-row {
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
      align-items: center;
    }
    .input-row label {
      font-size: 11px;
      color: #555;
      min-width: 52px;
    }
    .input-row input {
      flex: 1;
      border-radius: 999px;
      border: 1px solid #ddd5ff;
      padding: 7px 9px;
      font-size: 12px;
      outline: none;
      background: #faf8ff;
    }
    .input-row input:focus {
      border-color: #8f7bf5;
      background: #fff;
    }

    .btn {
      border-radius: 999px;
      border: none;
      padding: 9px 16px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: transform 0.05s ease-out, box-shadow 0.05s ease-out, background 0.1s;
      user-select: none;
    }
    .btn-primary {
      background: linear-gradient(135deg, #8f7bf5, #f58fdc);
      color: #fff;
      box-shadow: 0 10px 22px rgba(143, 123, 245, 0.35);
    }
    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 12px 26px rgba(143, 123, 245, 0.45);
    }
    .btn-primary:active {
      transform: translateY(0);
      box-shadow: 0 4px 12px rgba(143, 123, 245, 0.35);
    }
    .btn:disabled {
      opacity: 0.6;
      cursor: default;
      transform: none;
      box-shadow: none;
    }
    .btn-mini {
      font-size: 11px;
      padding: 6px 10px;
      background: #f4f0ff;
      color: #6b5ad8;
      box-shadow: none;
    }

    .badge-note {
      font-size: 10px;
      color: #999;
      margin-top: 6px;
    }
    .error {
      font-size: 11px;
      color: #d13b3b;
      margin-top: 6px;
    }

    .preview {
      font-size: 12px;
      max-height: 260px;
      overflow: auto;
      border-radius: 10px;
      border: 1px solid #f0ecff;
      padding: 10px 11px;
      background: #faf8ff;
    }
    .preview-line {
      margin-bottom: 4px;
    }
    .tag {
      display: inline-block;
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 999px;
      margin-right: 5px;
      background: #eee7ff;
      color: #6555d0;
    }
    .tag-info {
      background: #f1f5ff;
      color: #5b6bb5;
    }
    .ghost {
      color: #aaa;
      font-size: 11px;
      margin-top: 4px;
    }

    .feedback-area {
      width: 100%;
      min-height: 90px;
      font-size: 12px;
      padding: 9px 10px;
      border-radius: 10px;
      border: 1px solid #e0ddff;
      resize: vertical;
      font-family: inherit;
      background: #faf9ff;
    }
    .feedback-area:focus {
      outline: none;
      border-color: #8f7bf5;
      background: #fff;
    }
    .footer-note {
      font-size: 10px;
      color: #888;
      margin-top: 16px;
      text-align: right;
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <div class="logo">
        <div class="logo-mark">â™ª</div>
        <div>
          <div class="logo-text-main">SingKANA</div>
          <div class="logo-text-sub">è‹±èªæ­Œè© â€º æ—¥æœ¬èªã‹ãªï½œÎ²ãƒ†ã‚¹ãƒˆç‰ˆ</div>
        </div>
      </div>
      <div class="badge-beta">FOR BETA TESTERS</div>
    </header>

    <section class="hero">
      <div class="hero-pill">è‹±èªæ­Œè©ã‚’ã€Œæ­Œãˆã‚‹ã‹ãªã€ã«å¤‰æ›ã™ã‚‹ã‚¹ã‚¿ã‚¸ã‚ª</div>
      <div class="hero-title">è‹±èªã®ã¾ã¾æ­Œã„ãŸã„äººã®ãŸã‚ã®ã€Œã‹ãªå¤‰æ›ã€å®Ÿé¨“ç‰ˆ</div>
      <div class="hero-sub">
        è‹±èªæ­Œè©ã‚’ã“ã“ã«è²¼ã‚Šä»˜ã‘ã‚‹ã¨ã€æ—¥æœ¬èªè©±è€…ãŒã‚«ãƒ©ã‚ªã‚±ã§æ­Œã„ã‚„ã™ã„ã€Œã‹ãªè¡¨è¨˜ã€ã«å¤‰æ›ã—ã¾ã™ã€‚<br />
        ã“ã®ãƒšãƒ¼ã‚¸ã¯ <b>ã‚¯ãƒ­ãƒ¼ã‚ºãƒ‰Î²ãƒ†ã‚¹ãƒˆ</b> ç”¨ã§ã™ã€‚æ°—ã¥ã„ãŸã“ã¨ã‚’ä¸‹ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯æ¬„ã‹ã‚‰æ•™ãˆã¦ã‚‚ã‚‰ãˆã‚‹ã¨ã€ã¨ã¦ã‚‚åŠ©ã‹ã‚Šã¾ã™ã€‚
      </div>
      <button id="btn-scroll" class="btn btn-mini">ã‚¹ã‚¿ã‚¸ã‚ªã¸ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«</button>
    </section>

    <section class="layout" id="studio">
      <!-- å·¦ï¼šå…¥åŠ› & å¤‰æ› -->
      <div class="card">
        <div class="card-title">æ­Œè©å…¥åŠ›</div>
        <div class="card-sub">
          1. æ›²åï¼ˆä»»æ„ï¼‰ã‚’å…¥ã‚Œã‚‹ â†’ 2. è‹±èªæ­Œè©ã‚’ä¸¸ã”ã¨è²¼ã‚Šä»˜ã‘ â†’ 3. ã€Œã“ã®æ­Œè©ã§å¤‰æ›ã™ã‚‹ã€
        </div>

        <div class="input-row">
          <label for="song-title">æ›²å</label>
          <input
            id="song-title"
            type="text"
            placeholder="ä¾‹: Sparkle / RADWIMPS (ä»»æ„)"
          />
        </div>

        <textarea
          id="lyrics"
          placeholder="ã“ã“ã«è‹±èªæ­Œè©ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚&#10;â€»æ›²åã ã‘ã§ã¯æ­Œè©ã¯è‡ªå‹•å–å¾—ã•ã‚Œã¾ã›ã‚“ã€‚"
        ></textarea>

        <div id="lyrics-error" class="error" style="display:none;"></div>
        <div class="badge-note">
          â€» æœ€å¤§ 2000æ–‡å­—ã¾ã§ã€‚é•·ã„æ›²ã¯è¤‡æ•°å›ã«åˆ†ã‘ã¦è©¦ã—ã¦ã‚‚ã‚‰ãˆã‚‹ã¨åŠ©ã‹ã‚Šã¾ã™ã€‚
        </div>

        <div style="margin-top:10px; display:flex; gap:8px; align-items:center;">
          <button id="btn-convert" class="btn btn-primary">
            <span>â–¶</span> ã“ã®æ­Œè©ã§å¤‰æ›ã™ã‚‹
          </button>
        </div>
      </div>

      <!-- å³ï¼šçµæœ & è¨­å®š -->
      <div class="card">
        <div class="card-title">å¤‰æ›çµæœãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</div>
        <div class="card-sub">
          å·¦ã§å¤‰æ›ã—ãŸçµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚<br />
          Î²ç‰ˆã§ã¯ã€Œã‹ãªã®èª­ã¿ã‚„ã™ã•ã€ã€Œãƒªã‚ºãƒ æ„Ÿã€ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã«é›†ä¸­ã—ã¦ã‚‚ã‚‰ãˆã‚Œã°OKã§ã™ã€‚
        </div>
        <div id="preview" class="preview">
          <div class="preview-line">
            <span class="tag tag-info">INFO</span>
            ã“ã“ã«ã€Œè‹±èª + ã‹ãªã€ã®ãƒšã‚¢ãŒè¡Œã”ã¨ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
          </div>
          <div class="ghost">
            ä¾‹ï¼‰EN: Take me higher, through the night<br />
            ã€€ã€€ KA: ã¦ã„ã ã¿ãƒ¼ ã¯ã„ã‚„ãƒ¼ã€ã™ã‚‹ãƒ¼ ã– ãªã„ã£
          </div>
        </div>

        <div class="badge-note">
          â€» STR / VIB / BELT ã¨ã„ã£ãŸæ­Œã„æ–¹ãƒãƒ¼ã‚¯ã¯ã€ç¾åœ¨ã¯ç”»é¢ä¸Šã«ã¯è¡¨ç¤ºã—ã¦ã„ã¾ã›ã‚“ï¼ˆå†…éƒ¨ã®ã¿ã§è¨ˆç®—ä¸­ï¼‰ã€‚<br />
          å°†æ¥çš„ã«ã€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚„ã‚¢ã‚¤ã‚³ãƒ³ã¨ã—ã¦åæ˜ äºˆå®šã§ã™ã€‚
        </div>
      </div>
    </section>

    <section class="layout" style="margin-top: 4px;">
      <div class="card">
        <div class="card-title">ä½¿ã„æ–¹ï¼ˆã‹ã‚“ãŸã‚“3ã‚¹ãƒ†ãƒƒãƒ—ï¼‰</div>
        <div class="card-sub">
          Î²ãƒ†ã‚¹ãƒˆã§ã¯ã€ä»¥ä¸‹ã®æµã‚Œã§1ã€œ3æ›²ã»ã©è©¦ã—ã¦ã‚‚ã‚‰ãˆã‚‹ã¨å¬‰ã—ã„ã§ã™ã€‚
        </div>
        <ul style="padding-left:18px; margin:0; font-size:12px; line-height:1.5;">
          <li>1. æ›²åï¼ˆä»»æ„ï¼‰ã¨è‹±èªæ­Œè©ã‚’è²¼ã‚Šä»˜ã‘ã‚‹</li>
          <li>2. ã€Œã“ã®æ­Œè©ã§å¤‰æ›ã™ã‚‹ã€ã‚’æŠ¼ã™</li>
          <li>3. å‡ºã¦ããŸã€Œã‹ãªã€ã‚’è¦‹ãªãŒã‚‰ã€æ­Œãˆãã†ã‹ã‚’ã‚¤ãƒ¡ãƒ¼ã‚¸ã™ã‚‹</li>
          <li>4. ä¸‹ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯æ¬„ã‹ã‚‰ã€æ°—ã«ãªã£ãŸç‚¹ã‚’é€ä¿¡</li>
        </ul>
        <div class="ghost" style="margin-top:6px;">
          ä¾‹ï¼‰ã€Œã‚µãƒ“ã®ã“ã®è¡Œã ã‘èª­ã¿ã¥ã‚‰ã„ã€ã€Œèªå°¾ãŒä¼¸ã³ã™ãã¦ãƒªã‚ºãƒ ãŒå–ã‚Šã¥ã‚‰ã„ã€ãªã©ã€ä¸»è¦³ã§OKã§ã™ã€‚
        </div>
      </div>

      <div class="card">
        <div class="card-title">ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯</div>
        <div class="card-sub">
          æ°—ã¥ã„ãŸã“ã¨ãƒ»è‰¯ã‹ã£ãŸç‚¹ãƒ»ç›´ã—ã¦ã»ã—ã„ç‚¹ãªã©ã€ãªã‚“ã§ã‚‚æ›¸ã„ã¦ã‚‚ã‚‰ãˆã‚‹ã¨é–‹ç™ºã®å‚è€ƒã«ãªã‚Šã¾ã™ã€‚
        </div>
        <textarea
          id="feedback"
          class="feedback-area"
          placeholder="ä¾‹ï¼‰ã‚µãƒ“ã®ã€Œhigherã€ã®ã¨ã“ã‚ã€ã‚‚ã£ã¨ä¼¸ã°ã—ãŸè¡¨è¨˜ã ã¨æ­Œã„ã‚„ã™ã„ã‹ã‚‚â€¦&#10;ä¾‹ï¼‰å…¨ä½“çš„ã«ã„ã„æ„Ÿã˜ã ã‘ã©ã€æ—©å£ã®éƒ¨åˆ†ã¯ã‚‚ã†å°‘ã—è‹±èªå¯„ã‚Šã§ã‚‚ã„ã„ã‹ã‚‚ã€‚"
        ></textarea>
        <div id="feedback-error" class="error" style="display:none;"></div>
        <div style="margin-top:8px; display:flex; gap:8px; align-items:center;">
          <button id="btn-feedback" class="btn btn-mini">
            ğŸ“ ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’é€ä¿¡
          </button>
          <div id="feedback-status" class="badge-note"></div>
        </div>
      </div>
    </section>

    <div class="footer-note">
      SingKANA Î² â€“ ã“ã®ãƒšãƒ¼ã‚¸ã¯ãƒ†ã‚¹ãƒˆç›®çš„ã®ãŸã‚äºˆå‘Šãªãåœæ­¢ãƒ»ä»•æ§˜å¤‰æ›´ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
    </div>
  </div>

  <script>
    const btnScroll = document.getElementById("btn-scroll");
    const studio = document.getElementById("studio");
    const lyricsInput = document.getElementById("lyrics");
    const lyricsError = document.getElementById("lyrics-error");
    const btnConvert = document.getElementById("btn-convert");
    const preview = document.getElementById("preview");

    const feedbackInput = document.getElementById("feedback");
    const feedbackError = document.getElementById("feedback-error");
    const btnFeedback = document.getElementById("btn-feedback");
    const feedbackStatus = document.getElementById("feedback-status");

    const MAX_CHARS = 2000;

    if (btnScroll && studio) {
      btnScroll.addEventListener("click", () => {
        studio.scrollIntoView({ behavior: "smooth", block: "start" });
      });
    }

    async function convertLyrics() {
      const text = (lyricsInput.value || "").trim();
      const songTitle = (document.getElementById("song-title").value || "").trim();

      if (!text) {
        lyricsError.style.display = "block";
        lyricsError.textContent = "è‹±èªæ­Œè©ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚";
        return;
      }
      if (text.length > MAX_CHARS) {
        lyricsError.style.display = "block";
        lyricsError.textContent =
          "2000æ–‡å­—ã‚’è¶…ãˆã¦ã„ã¾ã™ã€‚è‹±èªæ­Œè©ã‚’è¤‡æ•°å›ã«åˆ†ã‘ã¦å¤‰æ›ã—ã¦ãã ã•ã„ã€‚";
        return;
      }

      lyricsError.style.display = "none";
      lyricsError.textContent = "";

      const originalText = btnConvert.innerHTML;
      btnConvert.disabled = true;
      btnConvert.innerHTML = "<span>â€¦</span> å¤‰æ›ä¸­";

      preview.innerHTML =
        '<div class="preview-line"><span class="tag tag-info">INFO</span> å¤‰æ›ä¸­ã§ã™â€¦</div>';

      try {
        const res = await fetch("/api/convert", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ lyrics: text })
        });

        const data = await res.json();
        if (!res.ok) {
          const msg = data && data.error ? data.error : "å¤‰æ›APIã®å‘¼ã³å‡ºã—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚";
          throw new Error(msg);
        }

        const lines = Array.isArray(data.lines) ? data.lines : [];
        if (!lines.length) {
          throw new Error("å¤‰æ›çµæœãŒç©ºã§ã—ãŸã€‚");
        }

        const items = lines
          .map((line) => {
            const en = line.en || "";
            const kana = line.kana || "";
            return (
              `<div class="preview-line"><span class="tag">EN</span>${en}</div>` +
              `<div class="preview-line"><span class="tag">KA</span>${kana}</div>`
            );
          })
          .join("");

        let header = "";
        if (songTitle) {
          header =
            `<div class="preview-line"><span class="tag tag-info">SONG</span>${songTitle}</div>` +
            `<div class="ghost">â€» æ›²åã¯ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯åˆ†æã®ã¿ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚</div><hr style="border:none;border-top:1px dashed #e0ddff;margin:6px 0;" />`;
        }

        preview.innerHTML = header + items;
      } catch (err) {
        console.error(err);
        lyricsError.style.display = "block";
        lyricsError.textContent = err.message || "å¤‰æ›ã«å¤±æ•—ã—ã¾ã—ãŸã€‚";
        preview.innerHTML =
          '<div class="preview-line"><span class="tag">ERR</span> å¤‰æ›ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ™‚é–“ã‚’ãŠã„ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚</div>';
      } finally {
        btnConvert.disabled = false;
        btnConvert.innerHTML = originalText;
      }
    }

    async function sendFeedback() {
      const text = (feedbackInput.value || "").trim();
      if (!text) {
        feedbackError.style.display = "block";
        feedbackError.textContent = "ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚";
        return;
      }
      feedbackError.style.display = "none";
      feedbackError.textContent = "";
      feedbackStatus.textContent = "é€ä¿¡ä¸­â€¦";

      try {
        const res = await fetch("/api/feedback", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ feedback: text })
        });
        const data = await res.json();
        if (!res.ok || !data.ok) {
          throw new Error(data.error || "é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
        }
        feedbackStatus.textContent = "é€ä¿¡ã—ã¾ã—ãŸã€‚ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼";
        feedbackInput.value = "";
      } catch (err) {
        console.error(err);
        feedbackStatus.textContent = "";
        feedbackError.style.display = "block";
        feedbackError.textContent = err.message || "é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚";
      }
    }

    btnConvert.addEventListener("click", convertLyrics);
    btnFeedback.addEventListener("click", sendFeedback);
  </script>
</body>
</html>

